[< back to README.md](../README.md)
# Phase 1: Core LAN Features

This document explains the detailed steps to implement **Phase 1** of the Internet CafÃ© System.

## ðŸŽ¯ Goal of Phase 1

Build a **Local Server + Client App** that works over LAN, with the following features:

* Clients log in using a **code** generated by the server.
* Timer countdown runs on client PCs.
* Alarm + lock screen when time runs out.
* Admin can manage client sessions (start, extend, end).
* Clients can **send requests** (e.g., extension) or **chat with server**.

## ðŸ“‚ Project Structure Setup

The following structure will be used as the **canonical plan**. All phases build on this.

```
/internet-cafe-system
â”‚â”€â”€ /server-app        # Admin / Local CafÃ© Server  
â”‚â”€â”€ /client-app        # Client PC Application  
â”‚â”€â”€ /docs              # Documentation (README, Phase1.md, etc.)  
â”‚â”€â”€ InternetCafe.sln   # Visual Studio solution file  
```

### Server App (Admin PC)

```
/server-app  
â”‚â”€â”€ Program.cs                # Entry point  
â”‚â”€â”€ App.config                # Configurations (DB path, ports, etc.)  
â”‚  
â”œâ”€â”€ /Forms  
â”‚   â”œâ”€â”€ MainForm.cs           # Main admin dashboard  
â”‚   â”œâ”€â”€ ClientListForm.cs     # List of connected clients  
â”‚   â”œâ”€â”€ SessionControlForm.cs # Start/extend/end sessions  
â”‚  
â”œâ”€â”€ /Database  
â”‚   â”œâ”€â”€ Database.cs           # SQLite connection handler  
â”‚   â”œâ”€â”€ SessionModel.cs       # Session entity  
â”‚   â”œâ”€â”€ ClientModel.cs        # Client entity  
â”‚   â”œâ”€â”€ Migrations/           # DB schema updates  
â”‚  
â”œâ”€â”€ /Networking  
â”‚   â”œâ”€â”€ ServerSocket.cs       # TCP/SignalR server  
â”‚   â”œâ”€â”€ MessageProtocol.cs    # Defines JSON message formats  
â”‚   â”œâ”€â”€ EncryptionHelper.cs   # Simple message encryption  
â”‚  
â””â”€â”€ /Utils  
    â”œâ”€â”€ CodeGenerator.cs      # Creates unique session codes  
    â”œâ”€â”€ TimerManager.cs       # Handles server-side timers  
    â”œâ”€â”€ Logger.cs             # Logs events and errors  
```

### Client App (Customer PC)

```
/client-app  
â”‚â”€â”€ Program.cs                # Entry point  
â”‚â”€â”€ App.config                # Configurations (server IP, port, etc.)  
â”‚  
â”œâ”€â”€ /Forms  
â”‚   â”œâ”€â”€ LoginForm.cs          # Enter session code  
â”‚   â”œâ”€â”€ TimerForm.cs          # Shows countdown timer  
â”‚   â”œâ”€â”€ LockScreenForm.cs     # Fullscreen lock when time is up  
â”‚  
â”œâ”€â”€ /Networking  
â”‚   â”œâ”€â”€ ClientSocket.cs       # Connects to server  
â”‚   â”œâ”€â”€ MessageHandler.cs     # Processes server commands  
â”‚   â”œâ”€â”€ EncryptionHelper.cs   # Matches serverâ€™s encryption  
â”‚  
â”œâ”€â”€ /Session  
â”‚   â”œâ”€â”€ SessionManager.cs     # Handles login, start, extend, expire  
â”‚   â”œâ”€â”€ AlarmManager.cs       # Popup + sound warning before time ends  
â”‚   â”œâ”€â”€ LockManager.cs        # Activates lock screen overlay  
â”‚  
â””â”€â”€ /Utils  
    â”œâ”€â”€ ConfigHelper.cs       # Reads/writes config (server IP, etc.)  
    â”œâ”€â”€ Logger.cs             # Logs events locally  
```

---

## ðŸ”— JSON Protocol Specification

All communication between **Server â†” Client** will use **JSON messages** over TCP/SignalR.
Each message must include:

* `type`: The command or event name.
* `payload`: Object containing relevant data.
* `timestamp`: UTC time when message was sent.
* `requestId`: Unique ID for matching request/response.

### 1. Session Management

#### Start Session (Server â†’ Client)

```json
{
  "type": "START_SESSION",
  "requestId": "srv-12345",
  "timestamp": "2025-09-19T10:00:00Z",
  "payload": {
    "sessionCode": "ABCD1234",
    "durationMinutes": 60,
    "clientId": "PC-05"
  }
}
```

#### Extend Session (Server â†’ Client)

```json
{
  "type": "EXTEND_SESSION",
  "requestId": "srv-12346",
  "timestamp": "2025-09-19T10:30:00Z",
  "payload": {
    "extraMinutes": 30
  }
}
```

#### End/Lock Session (Server â†’ Client)

```json
{
  "type": "LOCK_CLIENT",
  "requestId": "srv-12347",
  "timestamp": "2025-09-19T11:00:00Z",
  "payload": {
    "reason": "Time expired"
  }
}
```

### 2. Client Requests

#### Login Attempt (Client â†’ Server)

```json
{
  "type": "LOGIN_REQUEST",
  "requestId": "cli-001",
  "timestamp": "2025-09-19T10:05:00Z",
  "payload": {
    "sessionCode": "ABCD1234",
    "clientId": "PC-05"
  }
}
```

#### Request Extension (Client â†’ Server)

```json
{
  "type": "EXTENSION_REQUEST",
  "requestId": "cli-002",
  "timestamp": "2025-09-19T10:45:00Z",
  "payload": {
    "requestedMinutes": 30,
    "message": "Can I add 30 more minutes?"
  }
}
```

### 3. Messaging/Chat

#### Client to Server Chat

```json
{
  "type": "CHAT_MESSAGE",
  "requestId": "cli-003",
  "timestamp": "2025-09-19T10:50:00Z",
  "payload": {
    "from": "PC-05",
    "to": "SERVER",
    "message": "Need assistance, my keyboard is not working."
  }
}
```

#### Server to Client Chat

```json
{
  "type": "CHAT_MESSAGE",
  "requestId": "srv-12348",
  "timestamp": "2025-09-19T10:51:00Z",
  "payload": {
    "from": "SERVER",
    "to": "PC-05",
    "message": "We will check your keyboard shortly."
  }
}
```

### 4. Status Updates

#### Client Heartbeat (Client â†’ Server)

```json
{
  "type": "HEARTBEAT",
  "requestId": "cli-004",
  "timestamp": "2025-09-19T10:55:00Z",
  "payload": {
    "clientId": "PC-05",
    "remainingMinutes": 15,
    "status": "ACTIVE"
  }
}
```

#### Acknowledgement (Server â†” Client)

```json
{
  "type": "ACK",
  "requestId": "srv-12346",
  "timestamp": "2025-09-19T10:30:01Z",
  "payload": {
    "status": "SUCCESS",
    "details": "Extension granted"
  }
}
```

---

## âš¡ Folder Creation Script (Windows PowerShell)

Run the following commands in PowerShell to generate the full structure:

```powershell
# Create root repository
mkdir internet-cafe-system
cd internet-cafe-system

# Create main folders
mkdir server-app, client-app, docs

# Create placeholder Visual Studio solution file
New-Item InternetCafe.sln -ItemType File

# -----------------------
# Server App (Admin PC)
# -----------------------
cd server-app
New-Item Program.cs -ItemType File
New-Item App.config -ItemType File
mkdir Forms, Database, Networking, Utils

# Forms
cd Forms
New-Item MainForm.cs -ItemType File
New-Item ClientListForm.cs -ItemType File
New-Item SessionControlForm.cs -ItemType File
cd ..

# Database
cd Database
New-Item Database.cs -ItemType File
New-Item SessionModel.cs -ItemType File
New-Item ClientModel.cs -ItemType File
mkdir Migrations
cd ..

# Networking
cd Networking
New-Item ServerSocket.cs -ItemType File
New-Item MessageProtocol.cs -ItemType File
New-Item EncryptionHelper.cs -ItemType File
cd ..

# Utils
cd Utils
New-Item CodeGenerator.cs -ItemType File
New-Item TimerManager.cs -ItemType File
New-Item Logger.cs -ItemType File
cd ../..

# -----------------------
# Client App (Customer PC)
# -----------------------
cd client-app
New-Item Program.cs -ItemType File
New-Item App.config -ItemType File
mkdir Forms, Networking, Session, Utils

# Forms
cd Forms
New-Item LoginForm.cs -ItemType File
New-Item TimerForm.cs -ItemType File
New-Item LockScreenForm.cs -ItemType File
cd ..

# Networking
cd Networking
New-Item ClientSocket.cs -ItemType File
New-Item MessageHandler.cs -ItemType File
New-Item EncryptionHelper.cs -ItemType File
cd ..

# Session
cd Session
New-Item SessionManager.cs -ItemType File
New-Item AlarmManager.cs -ItemType File
New-Item LockManager.cs -ItemType File
cd ..

# Utils
cd Utils
New-Item ConfigHelper.cs -ItemType File
New-Item Logger.cs -ItemType File
cd ../..
```

---

## âœ… Deliverable for Step 1

After running the script, you will have the **canonical folder structure** with placeholder files **plus a JSON protocol reference** for implementing communication.  This ensures coding can begin with clear guidelines.

## make a minimal working prototype:

### Step 1: Establish Socket Communication

- [x] Implement ServerSocket.cs (server listens for client connections).
- [x] Implement ClientSocket.cs (client connects to server).
- [ ] Implement MessageProtocol.cs (shared JSON serialization/deserialization).
- [x] Test sending/receiving a basic â€œHELLOâ€ message.

    - [x] `cd cafe-mate\internet-cafe-system`
    - [x] `dotnet new sln -n InternetCafe` Create a new solution file `./InternetCafe.sln`
    - [x] `dotnet new winforms -n server-app` Create projects `internet-cafe-system\server-app\server-app.csproj`
    - [x] `dotnet new winforms -n client-app` Create projects `internet-cafe-system\client-app\client-app.csproj`
    - [x] `dotnet sln InternetCafe.sln add server-app/server-app.csproj` Add projects to the solution
    - [x] `dotnet sln InternetCafe.sln add client-app/client-app.csproj` Add projects to the solution
    - [x] `dotnet build InternetCafe.sln` build  
    or
    - [ ] run thi PowerShell script [init-phase1](init-phase1.ps1)
  

### Step 2: Implement Session Basics

- [ ] Server can accept a START_SESSION command.

- [ ] Server responds with SESSION_STARTED.

- [ ] Client shows a countdown timer (TimerForm.cs).

### Step 3: Add Chat (extension request)

- [ ] Client sends CHAT_MESSAGE â†’ â€œPlease extend my session.â€

- [ ] Server can reply via CHAT_MESSAGE.